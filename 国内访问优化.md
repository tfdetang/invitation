# 国内访问速度优化指南

## 一、DNS 优化

### 1. 使用国内 DNS 解析服务

如果你的域名在国内服务商（阿里云、腾讯云等），可以：

**阿里云 DNS：**
- 登录阿里云控制台
- 添加 CNAME 记录指向 `invitation.pages.dev`
- 启用"全球加速"或"智能解析"

**腾讯云 DNSPod：**
- 添加 CNAME 记录
- 启用"分地区解析"，国内外使用不同线路

**Cloudflare DNS 优化：**
- 在域名的 DNS 设置中
- 将代理状态从"已代理"改为"仅 DNS"（橙色云改为灰色云）
- 但这样会失去 Cloudflare 的 CDN 保护

### 2. 修改本地 DNS 服务器（用户端）

建议用户使用国内快速 DNS：
- 阿里 DNS：223.5.5.5 / 223.6.6.6
- 腾讯 DNS：119.29.29.29
- 114 DNS：114.114.114.114

## 二、Cloudflare 配置优化

### 1. 启用速度优化功能

在 Cloudflare Dashboard 中：

**性能优化：**
1. 进入域名管理
2. 点击"速度" → "优化"
3. 启用以下功能：
   - ✅ Auto Minify（自动压缩 CSS/JS/HTML）
   - ✅ Brotli 压缩
   - ✅ Early Hints
   - ✅ Rocket Loader（可选，可能影响交互）

**缓存设置：**
1. 进入"缓存" → "配置"
2. 浏览器缓存 TTL：设置为 4 小时或更长
3. 启用"始终在线"

### 2. 修改 Caching Level

- 进入"缓存" → "缓存级别"
- 选择"标准"或"忽略查询字符串"

## 三、静态资源优化

### 1. 图片压缩

```bash
# 安装图片压缩工具
npm install -D vite-plugin-imagemin

# 或手动压缩图片
# 使用 TinyPNG、ImageOptim 等工具
```

### 2. 启用 WebP 格式

创建 `vite.config.js` 插件配置，自动转换图片为 WebP。

### 3. 懒加载优化

当前照片已使用 `loading="lazy"`，可以进一步优化：

```jsx
// 使用 Intersection Observer 更精确控制加载时机
const [visible, setVisible] = useState(false);
const imgRef = useRef();

useEffect(() => {
  const observer = new IntersectionObserver(([entry]) => {
    if (entry.isIntersecting) {
      setVisible(true);
      observer.disconnect();
    }
  });
  if (imgRef.current) observer.observe(imgRef.current);
}, []);
```

## 四、代码优化

### 1. 代码分割

```javascript
// 路由懒加载
const PhotoGallery = lazy(() => import('./PhotoGallery'));
```

### 2. 移除未使用的依赖

检查并移除未使用的包，减小打包体积。

## 五、替代方案（需要备案）

如果域名有 ICP 备案，可以考虑：

### 1. 使用国内 CDN

**七牛云 CDN：**
- 免费额度：10GB 流量/月
- 上传构建产物到七牛云存储
- 配置 CDN 加速域名

**阿里云 OSS + CDN：**
- 将 `dist` 目录上传到 OSS
- 启用 CDN 加速
- 配置自定义域名

**腾讯云 COS + CDN：**
- 类似阿里云方案

### 2. Vercel（备选）

Vercel 在国内的速度通常比 Cloudflare 好：
- 支持自动部署
- 全球 CDN（包括香港节点）
- 配置更简单

```bash
# 安装 Vercel CLI
npm i -g vercel

# 部署
vercel
```

## 六、网络层面优化

### 1. HTTP/3 支持

Cloudflare 默认启用，无需配置。

### 2. 减少请求数量

- 合并小图标为 SVG sprite
- 使用 CSS 代替小图片
- 减少字体文件数量

## 七、监测和诊断

### 1. 测速工具

```bash
# Ping 测试
ping your-domain.com

# 追踪路由
traceroute your-domain.com

# DNS 查询时间
dig your-domain.com
```

### 2. 在线测速

- [17ce.com](https://www.17ce.com/) - 全国多节点测速
- [站长工具](https://ping.chinaz.com/) - Ping 检测
- [PageSpeed Insights](https://pagespeed.web.dev/) - 性能分析

## 八、快速优化检查清单

- [ ] 所有图片已压缩（使用 TinyPNG 等）
- [ ] 启用 Cloudflare 自动压缩
- [ ] 设置合理的缓存策略
- [ ] 移除未使用的依赖包
- [ ] 检查 DNS 解析速度
- [ ] 启用 Brotli 压缩
- [ ] 考虑使用国内 CDN（如有备案）

## 实际效果预期

- **不优化**：首屏加载 3-10 秒
- **基础优化**：首屏加载 1-3 秒
- **国内 CDN**：首屏加载 < 1 秒

## 推荐方案

**短期（无需备案）：**
1. 压缩所有图片（可立即提速 50%+）
2. 启用 Cloudflare 速度优化功能
3. 使用国内 DNS 服务商

**长期（需备案）：**
1. 域名备案
2. 迁移到阿里云/腾讯云 OSS + CDN
3. 或使用 Vercel 部署
